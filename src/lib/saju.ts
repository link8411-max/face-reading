// 사주팔자 계산 유틸리티

// 천간 (10개)
export const 천간 = ['갑', '을', '병', '정', '무', '기', '경', '신', '임', '계'] as const;
export const 천간한자 = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'] as const;

// 지지 (12개) - 띠
export const 지지 = ['자', '축', '인', '묘', '진', '사', '오', '미', '신', '유', '술', '해'] as const;
export const 지지한자 = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'] as const;
export const 띠동물 = ['쥐', '소', '호랑이', '토끼', '용', '뱀', '말', '양', '원숭이', '닭', '개', '돼지'] as const;
export const 띠이모지 = ['🐀', '🐂', '🐅', '🐇', '🐉', '🐍', '🐎', '🐏', '🐵', '🐔', '🐕', '🐷'] as const;

// 오행
export const 오행 = ['목', '화', '토', '금', '수'] as const;
export const 오행한자 = ['木', '火', '土', '金', '水'] as const;
export const 오행색상 = ['#22c55e', '#ef4444', '#eab308', '#f5f5f5', '#3b82f6'] as const;

// 천간 → 오행 매핑
export const 천간오행: Record<string, string> = {
  '갑': '목', '을': '목',
  '병': '화', '정': '화',
  '무': '토', '기': '토',
  '경': '금', '신': '금',
  '임': '수', '계': '수',
};

// 지지 → 오행 매핑
export const 지지오행: Record<string, string> = {
  '인': '목', '묘': '목',
  '사': '화', '오': '화',
  '진': '토', '술': '토', '축': '토', '미': '토',
  '신': '금', '유': '금',
  '해': '수', '자': '수',
};

// 음양
export const 천간음양: Record<string, '양' | '음'> = {
  '갑': '양', '을': '음',
  '병': '양', '정': '음',
  '무': '양', '기': '음',
  '경': '양', '신': '음',
  '임': '양', '계': '음',
};

// 년주 계산 (1900년 기준)
export function 년주계산(year: number): { 천간: string; 지지: string; 띠: string; 띠이모지: string } {
  const 천간인덱스 = (year - 4) % 10;
  const 지지인덱스 = (year - 4) % 12;

  return {
    천간: 천간[천간인덱스],
    지지: 지지[지지인덱스],
    띠: 띠동물[지지인덱스],
    띠이모지: 띠이모지[지지인덱스],
  };
}

// 월주 계산 (음력 기준 간소화)
export function 월주계산(year: number, month: number): { 천간: string; 지지: string } {
  const 년천간인덱스 = (year - 4) % 10;
  const 월천간시작 = (년천간인덱스 % 5) * 2;
  const 월천간인덱스 = (월천간시작 + month - 1) % 10;
  const 월지지인덱스 = (month + 1) % 12;

  return {
    천간: 천간[월천간인덱스],
    지지: 지지[월지지인덱스],
  };
}

// 일주 계산 (간소화 - 정확한 계산은 만세력 필요)
export function 일주계산(year: number, month: number, day: number): { 천간: string; 지지: string } {
  // 간소화된 계산 (정확도 낮음, 실제로는 만세력 데이터 필요)
  const baseDate = new Date(1900, 0, 1);
  const targetDate = new Date(year, month - 1, day);
  const diffDays = Math.floor((targetDate.getTime() - baseDate.getTime()) / (1000 * 60 * 60 * 24));

  const 천간인덱스 = (diffDays + 6) % 10;
  const 지지인덱스 = (diffDays + 10) % 12;

  return {
    천간: 천간[천간인덱스 < 0 ? 천간인덱스 + 10 : 천간인덱스],
    지지: 지지[지지인덱스 < 0 ? 지지인덱스 + 12 : 지지인덱스],
  };
}

// 오행 분포 계산
export function 오행분포계산(사주: { 년: { 천간: string; 지지: string }; 월: { 천간: string; 지지: string }; 일: { 천간: string; 지지: string } }) {
  const 분포: Record<string, number> = { 목: 0, 화: 0, 토: 0, 금: 0, 수: 0 };

  // 천간 오행
  분포[천간오행[사주.년.천간]]++;
  분포[천간오행[사주.월.천간]]++;
  분포[천간오행[사주.일.천간]]++;

  // 지지 오행
  분포[지지오행[사주.년.지지]]++;
  분포[지지오행[사주.월.지지]]++;
  분포[지지오행[사주.일.지지]]++;

  return 분포;
}

// 2026년 (병오년) 정보
export const 년도2026 = {
  천간: '병',
  지지: '오',
  오행: '화',
  띠: '말',
  띠이모지: '🐎',
  특징: '붉은 말의 해, 열정과 도약의 해',
};

// 띠별 2026년 기본 운세
export const 띠별운세2026: Record<string, { 총운: number; 키워드: string; 조언: string }> = {
  '쥐': { 총운: 4, 키워드: '기회', 조언: '새로운 도전이 행운을 가져옵니다' },
  '소': { 총운: 3, 키워드: '인내', 조언: '차분히 기다리면 좋은 일이 옵니다' },
  '호랑이': { 총운: 5, 키워드: '도약', 조언: '큰 변화를 두려워하지 마세요' },
  '토끼': { 총운: 3, 키워드: '신중', 조언: '큰 결정은 충분히 고민하세요' },
  '용': { 총운: 4, 키워드: '발전', 조언: '꾸준한 노력이 빛을 발합니다' },
  '뱀': { 총운: 4, 키워드: '지혜', 조언: '경험을 바탕으로 현명한 선택을 하세요' },
  '말': { 총운: 4, 키워드: '본명년', 조언: '건강과 자기관리에 집중하세요' },
  '양': { 총운: 5, 키워드: '행운', 조언: '적극적으로 나서면 좋은 결과가 있습니다' },
  '원숭이': { 총운: 3, 키워드: '안정', 조언: '현재에 충실하세요' },
  '닭': { 총운: 3, 키워드: '절제', 조언: '무리한 투자는 삼가세요' },
  '개': { 총운: 4, 키워드: '협력', 조언: '주변과의 관계가 중요합니다' },
  '돼지': { 총운: 4, 키워드: '성장', 조언: '배움에 투자하세요' },
};

// 전체 사주 분석
export function 사주분석(year: number, month: number, day: number) {
  const 년 = 년주계산(year);
  const 월 = 월주계산(year, month);
  const 일 = 일주계산(year, month, day);

  const 사주 = { 년: { 천간: 년.천간, 지지: 년.지지 }, 월, 일 };
  const 오행분포 = 오행분포계산(사주);

  // 가장 강한/약한 오행
  const 오행entries = Object.entries(오행분포);
  const 강한오행 = 오행entries.reduce((a, b) => a[1] > b[1] ? a : b)[0];
  const 약한오행 = 오행entries.reduce((a, b) => a[1] < b[1] ? a : b)[0];

  // 일간 (본인의 오행)
  const 일간오행 = 천간오행[일.천간];

  // 2026년 운세
  const 띠운세 = 띠별운세2026[년.띠];

  return {
    생년: year,
    생월: month,
    생일: day,
    사주: {
      년주: `${년.천간}${년.지지}`,
      월주: `${월.천간}${월.지지}`,
      일주: `${일.천간}${일.지지}`,
    },
    띠: 년.띠,
    띠이모지: 년.띠이모지,
    일간: 일.천간,
    일간오행,
    오행분포,
    강한오행,
    약한오행,
    음양: 천간음양[일.천간],
    운세2026: 띠운세,
  };
}
